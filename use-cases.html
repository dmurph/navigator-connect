<!DOCTYPE html>
<html>
  <head>
    <title>
      Use cases for the navigator.connect() API
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'>
</script>
    <script class="remove">
// (this is to make tidy happy)
      // See http://www.w3.org/respec/ for ReSpec documentation.
      var respecConfig = {
          specStatus: "unofficial",
          shortName: "navigator-connect-api",
          editors: [
            {
              name: "Marijn Kruisselbrink",
              company: "Google",
              companyURL: "https://www.google.com/"
            },
          ],
          edDraftURI:   "https://mkruisselbrink.github.io/navigator-connect/use-cases.html",
          noLegacyStyle: true,

          otherLinks: [{
            key: "Participate",
            data: [
              { value: "File bugs and feature requests",
                href: "https://github.com/mkruisselbrink/navigator-connect/issues",
              },
              { value: "Fix the text through GitHub",
                href: "https://github.com/mkruisselbrink/navigator-connect",
              },
            ],
          }],
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This document provides a collection of use cases for cross origin communication between
        service workers and webpages.
      </p>
    </section>
    <section id='sotd'></section>
    <section>
      <h2>
        Introduction
      </h2>
      <p>
        This document will use the term <code><dfn>navigator.connect</dfn>()</code> to refer to the
        notional API that allows cross-origin communication between service workers and web pages.
        This isn't intended to presuppose the final shape of the API, although we don't know of any
        alternate proposals.
      </p>
    </section>
    <section id="usecases">
      <h2>
        Use-Cases
      </h2>
      <section id='analytics'>
        <h2>
          Offline Analytics
        </h2>
        <p>
          Third party analytics platforms expose their services via REST interfaces. Thus, these
          platforms are unable to provide insights about offline behavior. As <a>Service
          Worker</a>s and offline web apps become more prevalent, the need for analytics platforms
          that function offline will continue to grow.
        </p>
        <p>
          <code><a>navigator.connect</a></code> enables third party analytics platforms to register
          <a>Service Worker</a>s that expose APIs to track metrics both online and offline. These
          <a>Service Worker</a>s are then able to report these metrics when connectivity is
          reestablished so that they can be consumed by the developer. Furthermore, this reporting
          can be implemented with background sync to take advantage of times when the user’s
          experience will not be impacted—for example, avoiding saturating the network with
          non-essential requests when the user is struggling with poor connectivity or on a heavily
          metered/throttled mobile plan. Thus, exposing analytics APIs via <a>Service Worker</a>s
          allows third party analytics platforms to reduce their performance costs even when
          online.
        </p>
        <p>
          Note that without <code><a>navigator.connect</a></code>, a web app frontend could report
          metrics to an analytics platform <a>Service Worker</a> via communication through an
          iframe. However, a web app’s <a>Service Worker</a> would not be able to communicate with
          the analytics platform in this way. Web app <a>Service Worker</a>s perform crucial
          tasks—both online and offline—that are valuable for developers to track.
          <code><a>navigator.connect</a></code> enables the <a>Service Worker</a> to <a>Service
          Worker</a> communication that is necessary for this robust web app analytics model.
        </p>
      </section>
      <section id='fonts'>
        <h2>
          Shared fonts
        </h2>
        <p>
          Fonts are a shared resource where latency is critical. People expect the text on a web
          page to be readable while the images and/or videos load. Latin fonts are 50-200 KB and
          download in 0.5 to 1.0 seconds, which is sluggish but acceptable. Chinese/Japanese/Korean
          (CJK) fonts are 4-20 MB and download in 10 to 30+ seconds, which is unacceptably slow.
          Having a way to preload and persist fonts locally (say, in IndexedDB) provides a much
          better user experience for CJK (and also Latin) users. However, local persistence
          mechanisms (e.g. IndexedDB) are domain specific: if the same font is used in multiple
          domains, it must be persisted separately for each domain. Although cache hits in the URL
          cache can somewhat help reduce the total download bandwidth for a font, it is still
          likely to be downloaded many times. If 100 sites use the same font then it will need to
          be persisted separately 100 times. Having a cross domain service reduces unnecessary
          latency and storage costs for fonts (and other such shared resources).
        </p>
        <p>
          Such a cross domain service can be implemented in the form of a <a>Service Worker</a> and
          <code><a>navigator.connect</a></code> protocols. This implementation opens up additional
          opportunities as well. For instance, the <a>Service Worker</a> can use the <a>background
          sync API</a> to schedule rationalization and optimization work when the network and CPU
          are idle, including:
        </p>
        <ul>
          <li>Optimizing the cache for efficiency by removing rarely used fonts
          </li>
          <li>Fetching complete fonts to replace previously downloaded subsets
          </li>
          <li>Updating fonts to their newest versions
          </li>
          <li>Automatically fetching the most popular fonts for a given user
          </li>
        </ul>
        <p>
          Note that a shared fonts service could be implemented without
          <code><a>navigator.connect</a></code>, although it would be quite awkward. With
          <code><a>navigator.connect</a></code>, the optimization can happen in the background,
          with a web app’s <a>Service Worker</a> handling the front end’s font request and
          communicating with the shared fonts service as necessary. In this way,
          <code><a>navigator.connect</a></code> enables a transparent and elegant solution that
          avoids the need to alter CSS loading.
        </p>
        <p class='issue'>
          TODO(slightlyoff): add more details on the difference between the with- and
          without-<code><a>navigator.connect</a></code> implementations.
        </p>
      </section>
    </section>
    <section id="security+privacy">
      <h2>
        Security and Privacy Considerations
      </h2>
      <p>
        User agents should not leak any information on sites a user has visited etc to other
        webpages, unless the visited site opts in. In particular this means that a service
        rejecting a connection attempt should be indistinguishable from no service being installed
        to service a particular URL.
      </p>
      <p class="issue">
        If attempting to connect to a service can trigger installation of a service worker, we need
        to fill in the security and privacy concerns around doing that.
      </p>
    </section>
    <section id='glossary' class='appendix'>
      <h2>
        Glossary
      </h2>
      <dl>
        <dt>
          <dfn>Background Sync API</dfn>
        </dt>
        <dd>
          See <a href=
          "https://github.com/slightlyoff/BackgroundSync/">https://github.com/slightlyoff/BackgroundSync/</a>.
        </dd>
        <dt>
          <dfn>Service Worker</dfn>
        </dt>
        <dd>
          See <a href=
          "https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html">https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html</a>.
        </dd>
      </dl>
    </section>
  </body>
</html>
